# 機能一覧

**Last Updated:** 2026-02-12

---

## 凡例

| カテゴリ | ID接頭辞 | 説明 |
|----------|----------|------|
| A: マスタ管理 | A01〜 | マスタデータの登録・一覧・編集 |
| B: 学習機能 | B01〜 | 受講者向けの学習・テスト・課題 |
| C: 決済・登録 | C01〜 | Stripe連携・コース登録・アクセス制御 |
| D: 評価・成績 | D01〜 | 採点・成績管理・合否判定 |
| E: 証明書 | E01〜 | 修了証発行・検証 |
| F: 管理・監査 | F01〜 | 管理者向けモニタリング・ログ・法的準拠 |

### Dev（開発区分）

| 値 | 意味 | 説明 |
|----|------|------|
| **Custom** | カスタム開発 | `local_timetrack` でコードを書く。CCSDD仕様書が必須 |
| **Config** | Moodle設定のみ | Moodle管理画面で設定するだけ。コード不要 |
| **ExtPlugin** | 外部プラグイン導入 | 既存の外部プラグインをインストール・設定 |
| **Content** | コンテンツ作成 | 法的文書・証明書デザイン等の原稿作成 |
| **Phase2** | MVP対象外 | Phase 2以降で対応 |

---

## 機能一覧テーブル

| ID | 機能名 | 概要 | Dev | 実装方式 | CCSDD Spec | Priority | Status |
|----|--------|------|-----|----------|------------|----------|--------|
| **A: マスタ管理** | | | | | | | |
| A01 | コース管理 | コースの作成・編集・公開設定 | Config | Moodle標準 | — | High | 未着手 |
| A02 | ユーザー管理 | 受講者・講師アカウントの管理 | Config | Moodle標準 | — | High | 未着手 |
| A03 | 単元(Section)管理 | コース内の単元構成・順序設定 | Config | Moodle標準 | — | High | 未着手 |
| **B: 学習機能** | | | | | | | |
| B01 | 動画視聴 | Vimeo埋め込み動画の視聴 | Config | Moodle標準 + Vimeo | — | Critical | 未着手 |
| B02 | 教材閲覧 | テキスト・スライド教材の表示 | Config | Moodle標準 (Page/Book) | — | High | 未着手 |
| B03 | 単元テスト | 各単元の理解度テスト(70%合格) | Config | Moodle Quiz | — | Critical | 未着手 |
| B04 | 順次学習制御 | 単元テスト合格→次単元アンロック | Config | Activity Completion + Restrict Access | — | Critical | 未着手 |
| B05 | 学習時間計測 | 420時間の厳密な計測(Heartbeat 30秒間隔) | **Custom** | `local_timetrack` | timetrack | Critical | 未着手 |
| B06 | 累計時間表示 | ヘッダーに学習時間をリアルタイム表示 | **Custom** | `local_timetrack` (JS) | timetrack | High | 未着手 |
| B07 | 課題提出 | 教案(doc) + 試講動画(mp4)アップロード | Config | Moodle Assignment | — | High | 未着手 |
| B08 | タブ可視検知 | Page Visibility APIで非表示タブの計測停止 | **Custom** | `local_timetrack` (JS) | timetrack | Critical | 未着手 |
| B09 | アイドル検知 | mousemove/keydown/scroll + 5分タイムアウト | **Custom** | `local_timetrack` (JS) | timetrack | Critical | 未着手 |
| B10 | 複数タブ排除 | BroadcastChannel APIで同一ブラウザのパラレル受講防止 | **Custom** | `local_timetrack` (JS) | timetrack | Critical | 未着手 |
| B11 | 早送り防止 | Vimeo SDK seeking/seekedイベントで未視聴区間スキップ阻止 | **Custom** | `local_timetrack` (JS) | timetrack | Critical | 未着手 |
| B12 | 倍速再生対策 | playbackratechange→強制1.0x or 時間補正 | **Custom** | `local_timetrack` (JS) | timetrack | High | 未着手 |
| B13 | 動画視聴セグメント記録 | 15秒間隔のビデオ進捗トラッキング | **Custom** | `local_timetrack` (video) | timetrack | High | 未着手 |
| B14 | 理解度チェック | 定期ポップアップ確認 + 単元テスト | **Custom** | Moodle標準 + `local_timetrack` | timetrack | High | 未着手 |
| **C: 決済・登録** | | | | | | | |
| C01 | Stripe決済 (MVP) | paygw_stripe + enrol_feeによるコース購入 | Config | Moodle標準 (paygw_stripe) | — | High | 未着手 |
| C02 | 自動コース登録 (MVP) | enrol_fee標準機能による即時登録 | Config | Moodle標準 (enrol_fee) | — | High | 未着手 |
| C03 | Custom Webhook決済 (Phase 2) | Stripe Checkout→Webhook→即時登録(事前登録不要UX) | Phase2 | Custom Plugin (Phase 2) | stripe-webhook | Medium | 未着手 |
| **D: 評価・成績** | | | | | | | |
| D01 | 課題添削・採点 | 講師による教案・動画の評価(60点満点) | Config | Moodle Assignment + Rubric | — | High | 未着手 |
| D02 | 最終試験 | オンライン総合試験(40点満点) | Config | Moodle Quiz | — | High | 未着手 |
| D03 | 成績集計 | 課題(60)+試験(40)=合計100の自動集計 | Config | Moodle Gradebook | — | High | 未着手 |
| D04 | 合否判定 | 合計60点以上＋各項目60%以上の判定 | **Custom** | `local_timetrack` | timetrack | High | 未着手 |
| **E: 証明書** | | | | | | | |
| E01 | 修了証発行 | 条件達成時のPDF自動生成(検証番号付き) | ExtPlugin | Custom Certificate | — | Medium | 未着手 |
| E02 | 修了証ダウンロード | 受講者によるPDFダウンロード | ExtPlugin | Custom Certificate | — | Medium | 未着手 |
| **F: 管理・監査** | | | | | | | |
| F01 | 学習進捗モニタリング | 受講者別の進捗・420時間達成状況 | **Custom** | `local_timetrack` (Admin) | timetrack | High | 未着手 |
| F02 | 不正検知ログ | IP・Heartbeatジッター分析・ボット検知 | **Custom** | `local_timetrack` (Log) | timetrack | High | 未着手 |
| F03 | 売上管理 | Stripe決済履歴・売上集計 | Config | Stripe Dashboard (MVP) | — | Medium | 未着手 |
| F04 | 特定商取引法表記 | 法的必須表示ページ(全ページフッターリンク) | Content | Moodle標準 (静的ページ) | — | Critical | 未着手 |
| F05 | 同時ログイン制限 | limitconcurrentlogins=1 + auth_uniquelogin | Config | Moodle標準 (設定) | — | High | 未着手 |
| F06 | レート制限 | 1ユーザーあたり最大3 Heartbeat/分 | **Custom** | `local_timetrack` | timetrack | High | 未着手 |
| F07 | 日次学習上限 | 1日最大8時間(設定可能)の異常値排除 | **Custom** | `local_timetrack` | timetrack | High | 未着手 |
| F08 | 監査証跡 | IP・UserAgent・セッションID記録 | **Custom** | `local_timetrack` (Log) | timetrack | High | 未着手 |
| F09 | トークン検証 | HMAC署名ローテーション + ワンタイムトークン | **Custom** | `local_timetrack` | timetrack | High | 未着手 |

---

## Dev区分の集計

| Dev区分 | 機能数 | 該当機能ID | CCSDD仕様 |
|---------|--------|-----------|-----------|
| **Custom** | 16 | B05-B06, B08-B14, D04, F01-F02, F06-F09 | 必須（timetrack） |
| **Config** | 17 | A01-A03, B01-B04, B07, C01-C02, D01-D03, F03, F05 | 不要 |
| **ExtPlugin** | 2 | E01-E02 | 不要 |
| **Content** | 1 | F04 | 不要 |
| **Phase2** | 1 | C03 | 後日 |
| **合計** | **37** | | |

## 実装方式の分類

| 分類 | 説明 | 該当機能 |
|------|------|----------|
| **Moodle標準** | Moodle組み込み機能をそのまま使用 | A01〜A03, B01〜B04, B07, C01〜C02, D01〜D03, E01〜E02, F04〜F05 |
| **Custom Plugin** | `local_timetrack` で実装 | B05〜B06, B08〜B14, D04, F01〜F02, F06〜F09 |
| **Moodle標準+設定** | 標準機能の設定・組み合わせで実現 | B04 (Activity Completion), B14 (Quiz + Plugin) |
| **Phase 2** | Phase 2以降で実装 | C03 (Custom Webhook) |

## CCSDD Spec対応表

| CCSDD Feature Name | 対象機能ID | 説明 |
|--------------------|-----------|------|
| `timetrack` | B05〜B06, B08〜B14, D04, F01〜F02, F06〜F09 | 420時間学習計測・不正防止・進捗管理 |
| `stripe-webhook` | C03 | Phase 2: Custom Webhook決済・即時登録 |
| _(未定義)_ | E01, E02 | 修了証発行（Moodle標準で対応可能なら不要） |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-12 | Dev（開発区分）カラム追加: Custom/Config/ExtPlugin/Content/Phase2。Dev区分集計セクション追加 |
| 2026-02-11 | プラグイン名 `local_timetrack` に統一、不正防止機能(B08-B14)追加、法的準拠(F04)追加、セキュリティ(F05-F09)追加、Stripe段階的アプローチ反映 |
| 2026-02-11 | 初版作成（01_system_architecture.md v1.1.0 ベース） |
